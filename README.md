Тестовое задание:

Спроектировать и разработать систему регистрации и обработки пользовательских
заявок.
Пользователь посредством системы может подавать заявки оператору на рассмотрение.
Оператор может просматривать пользовательские заявки и принимать или отклонять их.
Администратор управляет правами доступа.
• Спроектировать и разработать back-приложение
• Спроектировать и разработать Базу данных (Liquibase)
Функции приложения
• Создать заявку (Заявка помимо прочих системных полей состоит из статуса и
текстового обращения пользователя, номера телефона, имени)
• Отправить заявку оператору на рассмотрение
• Просмотреть список заявок с возможностью сортировки по дате создания в оба
направления (как от самой старой к самой новой, так и наоборот) и пагинацией
по 5 элементов, фильтрация по статусу
• Посмотреть заявку
• Принять заявку
• Отклонить заявку
• Просмотреть список пользователей
• Назначить права оператора
• Заявки могут дублироваться (это некоммерческий проект. важно увидеть только то, как
вы реализуете функционал)
В системе предусмотрены 3 роли:
• Пользователь
• Оператор
• Администратор
У пользователя системы может быть одновременно несколько ролей, например,
«Оператор» и «Администратор».
У заявки пользователя предусмотрено 4 статуса:
• черновик
• отправлено
• принято
• отклонено
Пользователь может
• логиниться в систему (выдача jwt и access токенов)
• выходить из системы /logout
• создавать заявки
• создавать черновики
• просматривать созданные им заявки с возможностью сортировки по дате
создания в оба направления (как от самой старой к самой новой, так и наоборот)
и пагинацией по 5 элементов
• редактировать созданные им заявки в статусе «черновик»
• отправлять заявки на рассмотрение оператору
Пользователь НЕ может:
• редактировать отправленные на рассмотрение заявки
• видеть заявки других пользователей
• принимать заявки
• отклонять заявки
• назначать права
• смотреть список пользователей
Оператор может
• логиниться в систему (выдача jwt и access токенов)
• выходить из системы /logout
• смотреть все отправленные на рассмотрение заявки с возможностью
сортировки по дате создания в оба направления (как от самой старой к самой
новой, так и наоборот) и пагинацией по 5 элементов. Должна быть фильтрация по имени.
Просматривать отправленные заявки только конкретного пользователя по его
имени/части имени (у пользователя, соответственно, должно быть поле name)
• смотреть заявку по id
• принимать заявки
• отклонять заявки
Оператор НЕ может
• создавать заявки
• просматривать заявки в статусе отличном от «отправлено»
• редактировать заявки
• назначать права
Администратор может
• логиниться в систему (выдача jwt и access токенов)
• выходить из системы /logout
• смотреть список пользователей
• смотреть заявки в статусе отправлено, принято, отклонено. Пагинация 5 элементов,
сортировка по дате. Фильтрация по имени.
• назначать пользователям права оператора
Администратор НЕ может
• создавать заявки
• редактировать заявки
• принимать заявки
• отклонять заявки
Технические требования к приложению
• Java 11 или 17
• Использовать архитектуру REST
• Использовать Spring Boot
• Использовать Spring Security
• Использовать JPA
• Использовать реляционную БД (PostgreSQL, MariaDB)
• Миграцию осуществлять с помощью Liquibase
• Создание пользователей и ролей не предусмотрено в этой системе.
Подразумевается, что данные об учетных записях пользователей и роли уже есть в
БД
• В описании ТЗ пропишите все креды (логин:пароль) всех созданных вами пользователей
• Запуск с помощью встроенного сервера приложений Apache Tomcat в Spring Boot (Не
Docker)
• Приложение должно запускаться без каких-либо ошибок
Плюсом будет:
Проводить проверку номер телефона через сервис Dadata. Не нужно делать для этого
отдельный эндпоинт. Внимательно изучите АПИ dadata.
Отправлять запрос через Spring Cloud Open Feign, сохранять данные в формате: код
страны, код города, номер телефона который придет в ответе. Номер телефона должен
быть мобильный.

### Проект "testTask2".

### Для запуска проекта :

1. Создать БД командой `create database itemService;` ;

2. В файле "application.properties" вам необходимо внести ваши данные:
      (как минимум : пароль для БД, токен для сервиса DaData и секретный
      ключ для сервиса DaData)
- spring.datasource.url=jdbc:postgresql://127.0.0.1:5432/itemService
- spring.datasource.username=postgres
- spring.datasource.password='passwordForItemService'(пароль для БД)
- app.aPiDaDataToken=Token 'token'(Токен для сервиса DaData)
- app.aPiDaDataSecret='secret'(Секретный ключ для сервиса DaData)

Токен и секретный ключ для сервиса DaData можно получить при регистрации на
сервисе: https://dadata.ru/api/ ;

3. В файле "liquibase.properties" вам также необходимо внести ваши данные:
   (как минимум : пароль для БД)
- changeLogFile=src/main/resources/liquibase-changeLog.xm
- url=jdbc:postgresql://127.0.0.1:5432/itemService
- username=postgres
- password='passwordForItemService'(пароль для БД) ;

4. Запустить приложение командой `mvn spring-boot:run;` ;


5. Чтобы выполнить какие - либо действия, необходимо использовать
следующие данные для авторизации:

/auth/sign-in/

POST

{
"username" : "User_Test",
"password" : "12345678900"
}

{
"username" : "Operator_Test",
"password" : "12345678901"
}

{
"username" : "Administrator_Test",
"password" : "12345678902"
} ;

6. Создайте нужное вам количество заявок(с ролью "User") :

/item/createItem/

POST

{
"name" : "item_1",
"itemText" : "item_1_Text......"
}
.
.
.
{
"name" : "item_N",
"itemText" : "item_N_Text......"
} ;

7.  Если необходимо - добавьте еще пользователей :

    /auth/sign-up/

POST

{
"username" : "User_2",       /*(Имя пользователя должно содержать от 5 до 50 символов)*/
"password" : "12345678903",  /*(Длина пароля должна быть от 8 до 255 символов)*/
"email" : "Us_2@mail.ru",    /*(Адрес электронной почты должен содержать от 5 до 255 символов)*/
                             /*(Email адрес должен быть в формате user@example.com)*/    
"phone" : "+79211111114"     /*(Номер телефона должен содержать 11 - 12 символов)*/
}
.
.
.
{
"username" : "User_N",
"password" : "123456789004",
"email" : "User_N@mail.ru",
"phone" : "+79213333335"
} ;

8. Endpoints:

================================================================================================
Использованные данные, в качестве примера : {id}=1;{phone}=+79111111111;{email}=email@mail.ru;
{name}=User_Test;{name}=item_1;{itemText}=item_1_Text......;
{name}=item_1_NEW;{itemText}=item_1_Text_NEW......;
================================================================================================
/*ПРОВЕРКА НОМЕРА ТЕЛЕФОНА*/

/phone/

POST

{
"source"  : ["моб +79111111111"]
}

================================================================================================
/*АВТОРИЗАЦИЯ*/

/auth/sign-in/

POST

{
"username" : "username",
"password" : "password"
}
================================================================================================
/*ДОБАВЛЕНИЕ ПОЛЬЗОВАТЕЛЯ*/

/auth/sign-up/

POST

{
"username" : "username",
"password" : "password",
"email" : "email@mail.ru",
"phone" : "+79111111111"
}
================================================================================================
/*ВЫХОД(LOGOUT)*/

/auth/auth_logout/

POST
================================================================================================
/*НАЙТИ ПОЛЬЗОВАТЕЛЯ ПО ИМЕНИ*/

/person/findByUserName?userName=User_Test

GET
================================================================================================
/*Просмотреть список заявок  user-а с возможностью сортировки по дате создания в оба
направления (как от самой старой к самой новой, так и наоборот) и пагинацией
по 5 элементов, фильтрация по статусу ("hasRole('USER')")*/

/item/sortItemsByUser?sortDirection=1

/item/sortItemsByUser?sortDirection=0


GET
=================================================================================================
/*СОЗДАТЬ ЗАЯВКУ ("hasRole('USER')")*/

/item/createItem/

{
"name" : "item_1",
"itemText" : "item_1_Text......"
}

POST
==================================================================================================
/*ОТПРАВИТЬ ЗАЯВКУ ОПЕРАТОРУ НА РАССМОТРЕНИЕ ("hasRole('USER')")*/

/item/sendItem/1

PUT
==================================================================================================
/* РЕДАКТИРОВАНИЕ  ЗАЯВОК В СТАТУСЕ "ЧЕРНОВИК", СОЗДАННЫХ ПОЛЬЗОВАТЕЛЕМ ("hasRole('USER')")*/

/item/editUserItem/1

{
"name" : "item_1_NEW",
"itemText" : "item_1_Text_NEW......"
}

PUT
===================================================================================================
/*Просмотреть список всех отправленных на рассмотрение заявок с возможностью
сортировки по дате создания в оба
направления (как от самой старой к самой новой, так и наоборот) и пагинацией
по 5 элементов, фильтрация по статусу. Должна быть фильтрация по имени.
Просматривать отправленные заявки только конкретного пользователя по его
имени/части имени (у пользователя, соответственно, должно быть поле name)
("hasRole('OPERATOR')")*/

/item/sortItemsByOperator?sortDirection=1&userName=User_Test

/item/sortItemsByOperator?sortDirection=0&userName=User_Test

GET
======================================================================================================
/*НАЙТИ ПО ID  ЗАЯВКУ ("hasRole('OPERATOR')*/

/item/findItem/1

GET
======================================================================================================
/*ПРИНЯТЬ ЗАЯВКУ ("hasRole('OPERATOR')*/

/item/acceptItem/1

PUT
======================================================================================================
/*ОТКЛОНИТЬ ЗАЯВКУ ("hasRole('OPERATOR')*/

/item/rejectItem/1

PUT
======================================================================================================
/*Просмотреть список заявок в любом статусе с возможностью сортировки по дате создания в оба
направления (как от самой старой к самой новой, так и наоборот) и пагинацией
по 5 элементов, фильтрация по статусу ("hasRole('ADMIN')*/


/item/sortItemsByAdmin?sortDirection=1&status=0&userName=User_Test

/item/sortItemsByAdmin?sortDirection=0&status=0&userName=User_Test

GET
========================================================================================================
/*смотреть список пользователей ("hasRole('ADMIN')*/

/item/findAllUsersList/

GET
========================================================================================================
/* назначать пользователям права оператора ("hasRole('ADMIN')*/

/item/setRoleOperator/1


PUT

========================================================================================================


Стек технологий : Java 17; PostgreSQL 14;spring-boot 2.7.14;.
Требования к окружению : Java 17, Maven 3.8, PostgreSQL 14 - 16.

Контакты : mariosb84@mail.ru .
